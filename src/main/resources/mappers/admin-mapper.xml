<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.hamo.admin.model.mapper.AdminMapper">
	<insert id="writeNotice">
		insert into admin_board
		values(seq_admin_board.nextval, #{title}, 
		#{content}, default, default, default, default, #{writer})
	</insert>
	
	<select id="getListCount" resultType="_int">
		select count(*)
		from admin_board
		where admin_board_status = 'Y'
	</select>
	
	<select id="selectNoticeList" resultType="Admin">
		select board_no, title, content, a.create_date, a.update_date, views, admin_board_status, writer, member_nickname
		from admin_board a
			 join member m on(writer=member_no)
		where admin_board_status = 'Y'
		order by create_date desc
	</select>
	
	<select id="selectNoticeOne" resultType="Admin">
		select  board_no, title, content
		from admin_board
		where admin_board_status = 'Y' and
			  board_no = #{id}
	</select>
	
	<update id="updateNotice">
		update admin_board
		set title=#{title},
			content=#{content},
			update_date=sysdate
		where board_no=#{boardNo}
	</update>
	
	<update id="deleteNotice">
		update admin_board
		set admin_board_status = 'N'
		where board_no=#{boardNo}
	</update>
	
	<select id="selectAllMember">
		select * 
		from member
		where is_admin = 'N'
	</select>
	<update id="changeStatus">
		update member
		set status=#{isStatus}
		where member_no=#{mId}
	</update>
	
	<select id="searchUserList" resultType="Member">
	    SELECT *
	    FROM member
	    WHERE member_name LIKE '%' || #{searchValue} || '%'
	</select>

	
	<select id="selectAllBoardList">
		select board_no, title, member_no, member_nickname
		from board b
			 join member m using(member_no)
		where board_status='Y'
	</select>
	
	<update id="deleteBoard">
		update board
		set board_status='N'
		where board_no=#{boardNo}
	</update>
	
	<select id="searchBoardList" resultType="Board">
	    select *
	    from board b
	    	 join member m on(b.member_no = m.member_no)
	    where board_status='Y'
	    <if test="searchCategory=='title'">
	        and title like '%' || #{searchValue} || '%'
	    </if>
	    <if test="searchCategory=='content'">
	        and content like '%' || #{searchValue} || '%'
	    </if>
	    <if test="searchCategory=='author'">
	        and member_nickname like '%' || #{searchValue} || '%'
	    </if>
	    <if test="searchCategory=='title_content'">
	        and (title like '%' || #{searchValue} || '%' 
	        or content like '%' || #{searchValue} || '%')
	    </if>
	</select>
	
	<select id="selectReportList" resultType="Report">
	    SELECT 
	        r.*, 
	        v.member_nickname AS violator_nick, 
	        rp.member_nickname AS reporter_nick
	    FROM 
	        report r
	        JOIN member v 
	             ON r.violator = v.member_no
	        JOIN member rp 
	             ON r.reporter = rp.member_no
	</select>

	
	<insert id="insertReport">
		insert into report
		values(seq_report.nextval, #{reportText}, default, default, #{reporter}, #{violator}, #{boardNo})
	</insert>
	
	<select id="selectReportOne" resultType="Report">
		select *
		from report
		where report_no=#{reportNo}
	</select>
	
	<update id="reportAccecpt">
		update report
		set report_status='A'
		where report_no = #{reportNo}
	</update>
	
	<update id="deleteUser">
		update member
		set status='N'
		where member_no = #{violatorNo}
	</update>
	
	<update id="reportReject">
		update report
		set report_status='R'
		where report_no = #{reportNo}
	</update>
	
	<select id="boardCount" resultType="dashboard">
		SELECT TRUNC(create_date) as create_date, COUNT(*) as count
		FROM board
		WHERE board_status = 'Y'
		GROUP BY TRUNC(create_date)
		ORDER BY TRUNC(create_date) DESC
	</select>
</mapper>