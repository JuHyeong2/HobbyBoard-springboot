<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>신고 페이지</title>
<link rel="stylesheet" href="/css/admin/reports.css">
</head>
<body>
    <div th:replace="admin/admin-main.html"></div>

    <div class="header">
        <h1>REPORT LIST</h1>

        <div class="content-wrapper">
            <!-- 신고 목록 -->
            <div class="report-list">
                <div class="report-card" th:each="r : ${rList}">
                    <form id="report-form">
                        <input type="hidden" name="boardNo" th:value="${r.boardNo}">
                        <input type="hidden" name="reportNo" th:value="${r.reportNo}">
                        <h3>신고 번호 : [[${r.reportNo}]]</h3>
                        <p>신고 내용: [[${r.reportText}]]</p>
                        <p>신고자: [[${r.reporterNick}]]</p>
                        <p th:switch="${r.reportStatus}">
                            <span th:case="'W'">대기 중</span>
                            <span th:case="'A'">처리 완료</span>
                            <span th:case="'R'">반려</span>
                        </p>
                        <!-- 버튼 그룹 수정 -->
                        <div class="button-group">
                            <button type="button" class="dropdown-toggle-btn" th:if="${r.reportStatus}=='W'">⋮</button>
                            <div class="dropdown-content">
                                <button type="button" class="accepct-btn">승인하기</button>
                                <button type="button" class="reject-btn">반려하기</button>
                            </div>
                        </div>
                    </form>
                    <button class="button resolve-btn">확인하기</button>
                </div>
            </div>
        </div>
    </div>
</body>
<script>
        // resolve-btn 클래스의 모든 버튼을 선택
        const buttons = document.querySelectorAll('.resolve-btn');
        const accepctBtns = document.querySelectorAll('.accepct-btn');
        const rejectBtns = document.querySelectorAll('.reject-btn');
        const dropdownToggles = document.querySelectorAll('.dropdown-toggle-btn');

        // 각 버튼에 클릭 이벤트 리스너 추가
        for (const button of buttons) {
            button.addEventListener('click', (e) => {
                const boardNo = e.target.parentElement.children[0].children[0].value;
                location.href='/board/' + boardNo;

            });
        }
        
        for(const accepctBtn of accepctBtns) {
            accepctBtn.addEventListener('click', (e) => {
                const form = e.target.closest('#report-form');
                if(confirm('신고를 승인하시겠습니까?')) {
                    form.action='/admin/reportAccepct';
                    form.method='post';
                    form.submit();
                    
                    if(/*[[${result}]]*/1 > 0) {
                        alert('신고 처리가 완료되었습니다.');
                    } else {
                        alert('신고 처리에 실패하였습니다.');
                    }
                } else {
                    alert('신고 승인을 취소합니다.');
                }
            });
        }
        
        for(const rejectBtn of rejectBtns) {
            rejectBtn.addEventListener('click', (e) => {
                const form = e.target.closest('#report-form');
                if(confirm('해당 신고 내역을 반려하시겠습니까?')) {
                    form.action='/admin/reportReject';
                    form.method='post';
                    form.submit();
                } else {
                    alert('신고 반려를 취소합니다.');
                }
            });
        }

        // Toggle dropdown content visibility
        for(const toggle of dropdownToggles) {
            toggle.addEventListener('click', (e) => {
                const content = e.target.nextElementSibling;
                content.style.display = content.style.display === 'block' ? 'none' : 'block';
                // Close other open dropdowns
                document.querySelectorAll('.dropdown-content').forEach(dropdown => {
                    if (dropdown !== content) {
                        dropdown.style.display = 'none';
                    }
                });
            });
        }

        // Close dropdown if clicking outside of it
        document.addEventListener('click', (e) => {
            if (!e.target.matches('.dropdown-toggle-btn')) {
                document.querySelectorAll('.dropdown-content').forEach(dropdown => {
                    dropdown.style.display = 'none';
                });
            }
        });
</script>
</html>
